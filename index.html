<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="index.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="style.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>
    <title>Geo VT</title>
</head>

<body>
    <div id="page-container">
        <div id="nav">Nav Bar
            <div id="info">INFO</div>
        </div>
        <div id="map-area">
            <div id="north" class="navbutton">North</div>
            <div id="west" class="navbutton">West</div>
            <div id="map"></div>
            <div id="east" class="navbutton">East</div>
            <div id="south" class="navbutton">South</div>
        </div>

        <div id="game-area">
            <button id="startgame" class='gamebutton'>Start Game</button>
            <div id="full-map"></div>
            <button id="guess" class='gamebutton'>Make Guess</button>
            <button id="giveup" class='gamebutton'>Give Up</button>

        </div>
    </div>
    <script>

        class Coordinates {
            constructor(lat, long) {
                this.lat = lat;
                this.long = long;
            }
            center() {
                return [this.lat, this.long]
            }
        }

        const startButton = document.getElementById('startgame');
        const guessButton = document.getElementById('guess');
        const giveUpButton = document.getElementById('giveup');


        myMap = L.map('map').setView([44.0886, -72.7317], 7);
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        }).addTo(myMap);

        let fullMap = L.map('full-map').setView([44.0886, -72.7317], 7)
        L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(fullMap);

        startButton.onclick = initalizeGame;
        guessButton.onclick = submitGuess;
        giveUpButton.onclick = giveUp;
        
        guessButton.disabled = true;
        giveUpButton.disabled = true;

        // start game, 
        // disables start button, 
        // disables zoom on game map
        // enables NESW buttons to pan game map
        // clears info bar
        function initalizeGame() {
            gameMap = new Coordinates(randomLat(), randomLong());
            console.log("answer coords: " + gameMap.lat, gameMap.long);
            randomMap();
            startButton.disabled = true;
            guessButton.disabled = true;
            giveUpButton.disabled = false;
            clear();
        };

        // generates random location for Game Map
        function randomMap() {
            myMap.panTo(gameMap.center());
            myMap.setZoom(18);
            myMap.removeControl(myMap.zoomControl);
            myMap.dragging.disable();
            myMap.touchZoom.disable();
            myMap.doubleClickZoom.disable();
            myMap.scrollWheelZoom.disable();
            myMap.boxZoom.disable();
            myMap.keyboard.disable();

            fullMap.once('click', addMarker);
        }

        function randomLat() {
                let lat = Math.random() * (45.00541896831666 - 42.730315121762715) + 42.730315121762715;
                return lat;
            }
        function randomLong() {
                let long = (Math.random() * (71.51022535353107 - 73.35218221090553) + 73.35218221090553) * -1;
                return long;
            }
        // guess location - click small map, or enter county name
        // get location of guess marker and determine error margin
        // record if win/lose
        // record score

        function addMarker(e) {
            guess = new Coordinates(e.latlng.lat, e.latlng.lng);
            console.log("guess: ", guess.lat, guess.long)

            let marker = new L.marker(guess.center(), { draggable: true }).addTo(fullMap);
            markers = new L.FeatureGroup();
            marker.addTo(markers);
            markers.addTo(fullMap);
            guessButton.disabled = false;
            marker.on('dragend', function (event) {
                let marker = event.target;
                let position = marker.getLatLng();
                guess.lat = position.lat;
                guess.long = position.lng;
                console.log("guess: ", guess.lat, guess.long);
                showInfo(guess);
                marker.setLatLng(new L.LatLng(position.lat, position.lng), { draggable: 'true' });
            });
            marker.bindPopup("<strong>" + e.latlng + "</strong>").addTo(fullMap).openPopup();
            showInfo(guess)
        }

        function submitGuess() {
            console.log("actual location: ", gameMap.center())
            console.log("guess location: ", guess.center());
            guessButton.disabled = true;
            giveUpButton.disabled = true;
            startButton.disabled = false;
            showAnswer();


        }
        // displays lat and long of game map in nav bar
        function showInfo(map) {
            document.getElementById('info').innerHTML = `latitude: ${map.center()[0]}, longitude: ${map.center()[1]}`
        }
        function clear() {
            document.getElementById('info').innerHTML = "";
            fullMap.removeLayer(markers);
        }
        // Give Up! - tells user correct location - lat/long, town and county
        // and resets map, disables give up and make guess button, enables start button
        function giveUp() {
            showInfo(gameMap);
            startButton.disabled = false;
            guessButton.disabled = true;
            giveUpButton.disabled = true;
            showAnswer();
        }

        function showAnswer() {
            let answermarker = new L.marker(gameMap.center(), { draggable: false }).addTo(fullMap);
            markers.addLayer(answermarker);
            answermarker.bindPopup("<strong>Actual Location</strong>").addTo(fullMap).openPopup();
        }

    </script>

</body>

</html>